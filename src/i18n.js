import React, { createContext, useContext, useState, useEffect } from 'react';

const LanguageContext = createContext({ lang: 'en', setLang: () => { } });

const TRANSLATIONS = {
	en: {
		'nav.help': 'Help',
		'nav.login': 'Login',
		'nav.signup': 'Get Started Free',
		'hero.title.line1': 'Classroom management',
		'hero.title.gradient': 'made magical.',
		'hero.subtext': 'The all-in-one platform for behavior tracking, engaging goals, and instant parent communication.',
		'help.label': 'Help',
		'search.placeholder': 'Search features...',
		'guide.badge': 'Classroom Manual',
		'hero.tag': 'Trusted by Modern Teachers',
		'cta.create_class': 'Create My Class',
		'features.title': 'Everything you need to run your class.',
		'modal.who': 'Choose your role',
		'role.teacher': 'Teacher',
		'role.teacher.desc': 'Create classes, assign behaviors, and track progress.',
		'role.parent': 'Parent',
		'role.parent.desc': "View your child's progress and receive updates.",
		'role.student': 'Student',
		'role.student.desc': 'Enter your class access code to see assignments.',
		'student.instructions': 'Enter your 5-digit class code to continue.',
		'student.verifying': 'Verifying...',
		'student.enter': 'Enter',
		'auth.create_btn': 'Create account',
		'auth.login_btn': 'Login',
		'auth.fullname': 'Full name',
		'auth.email': 'Email address',
		'auth.password': 'Password',
		'auth.confirm': 'Confirm password',
		'auth.forgot': 'Forgot password?',
		'auth.already': 'Already have an account?',
		'auth.newhere': 'New here?',
		'auth.create_account': 'Create account',
		'auth.login': 'Login',
		'nav.back': 'Back',
		'cta.join_today': 'Join today',
		'cta.ready': 'Ready to level up your classroom?',

		// --- Email Verification ---
		'auth.account_created': 'Account Created!',
		'auth.verify_msg': 'Please check your email and click the verification link to activate your account.',
		'auth.verify_block': 'You will not be able to log in until your email is verified.',
		'auth.goto_login': 'Go to Login',
		'auth.google_signin': 'Sign in with Google',
		'auth.or': 'or',

		// --- Feature Section ---
		'features.avatars.title': 'Custom Avatars',
		'features.avatars.desc': 'Let students express themselves with unique, fun avatars.',
		'features.reports.title': 'Instant Reports',
		'features.reports.desc': 'Track progress and share beautiful reports with parents.',
		'features.egg.title': 'Progress Meter',
		'features.egg.desc': 'Motivate your class with a collaborative progress journey.',
		'features.lucky.title': 'Lucky Draw',
		'features.lucky.desc': 'Random rewards to keep every lesson exciting.',
		'mockup.class_name': 'Class 4-B',
		'mockup.progress': 'Progress',
		'features.meter.title': 'Progress Meter',
		'features.meter.desc': 'Track your class\'s journey together. Celebrate milestones and motivate students with a real-time progress meter.',
		'features.lucky.title': 'Lucky Draw',
		'features.lucky.desc': 'Gamify your lessons! Randomly reward students for participation and effort with a single click.',
		'features.reports.title': 'Reports & Analytics',
		'features.reports.desc': 'Instantly visualize class and student progress. Export beautiful, parent-friendly reports in any language.',
		'features.avatars.title': 'Custom Avatars',
		'features.avatars.desc': 'Let every student express themselves with unique, fun avatars. Build classroom identity and belonging.',
		'features.studio.title': 'Assignments Studio',
		'features.studio.desc': 'Create, assign, and grade digital worksheets in seconds. Support all question types and instant feedback.',
		'features.codes.title': 'Access Codes',
		'features.codes.desc': 'Secure, simple logins for every student and parent. No more forgotten passwords or lost accounts.',
		'features.timer.title': 'Focus Timer',
		'features.timer.desc': 'Boost productivity with built-in timers for activities and tests. Visual cues for the whole class.',
		'features.buzzer.title': 'Attention Buzzer',
		'features.buzzer.desc': 'Regain focus instantly. Use the buzzer to get everyone\'s attention in a fun, non-disruptive way.',
		'features.whiteboard.title': 'Whiteboard',
		'features.whiteboard.desc': 'Draw, type, and export. Use the digital whiteboard for group work and creative lessons.',
		'features.grading.title': 'Messages & Grading',
		'features.grading.desc': 'Review, grade, and send feedback on student submissions. Keep communication clear and actionable.',
		'features.mgmt.title': 'Class Management',
		'features.mgmt.desc': 'Add or edit students instantly. Update names, avatars, and access codes with automatic saving.',
		'features.settings.title': 'Customization',
		'features.settings.desc': 'Configure points, cards, and class options. Fine-tune the platform for your specific teaching style.',

		// --- Access Codes Page ---
		'access_codes.title': 'Access Codes',
		'access_codes.search': 'Search students...',
		'access_codes.parent_code': 'Parent Code',
		'access_codes.student_code': 'Student Code',
		'access_codes.copy_qr': 'Copy QR',
		'access_codes.copied': 'Copied!',
		'access_codes.copy_fail': 'Failed to copy image. Your browser may not support this feature.',
		'access_codes.qr_fail': 'Failed to render QR code image.',

		// --- Behavior Modal ---
		'behavior_modal.give_points': 'Give Points',
		'behavior_modal.wow_cards': 'WOW CARDS',
		'behavior_modal.nono_cards': 'NO-NO CARDS',
		'behavior_modal.import': 'IMPORT',
		'behavior_modal.select_class': 'Select class to import from',
		'behavior_modal.choose_class': '-- Choose a class --',
		'behavior_modal.preview_new': 'Preview — {count} new card(s) will be imported',
		'behavior_modal.no_new': 'No new cards to import from selected class',
		'behavior_modal.importing': 'Importing…',
		'behavior_modal.import_new': 'Import New Cards',
		'behavior_modal.nothing_import': 'Nothing to Import',
		'behavior_modal.imported': 'Imported {count} new card(s).',
		'behavior_modal.all_set': 'You\'re all set — no new cards to import.',
		'behavior_modal.import_failed': 'Import failed: {message}',
		'behavior_modal.wow': 'WOW',
		'behavior_modal.no_no': 'NO NO',

		// --- Add Student Modal ---
		'add_student.title': 'Enrol New Student',
		'add_student.change_avatar': 'Change avatar',
		'add_student.upload_photo': 'Upload Photo',
		'add_student.change_photo': 'Change Photo',
		'add_student.remove': 'Remove',
		'add_student.gender': 'Gender',
		'add_student.boy': 'Boy',
		'add_student.girl': 'Girl',
		'add_student.name_placeholder': 'Student Name',
		'add_student.name_required': 'Please enter a student\'s name.',
		'add_student.cancel': 'Cancel (Esc)',
		'add_student.add': 'Add Student (Enter)',
		'add_student.image_large': 'Image is too large. Please choose a smaller image (under 1MB).',

		// --- Lucky Draw Modal ---
		'lucky_draw.title': 'Draw Group',
		'lucky_draw.select_students': 'Select number of Students ({count} available)',
		'lucky_draw.not_enough': 'Not enough students',
		'lucky_draw.add_at_least': 'Add at least 2 students before running a Lucky Draw (currently {count} student(s)).',
		'lucky_draw.too_many': 'You chose {count} winners but there are only {total} students.',
		'lucky_draw.chose_smaller': 'Choose a smaller number',
		'lucky_draw.add_students': 'Add Students',
		'lucky_draw.cancel': 'Cancel',
		'lucky_draw.selecting': 'Selecting...',
		'lucky_draw.selections': 'Selections!',
		'lucky_draw.selected': 'Selected',
		'lucky_draw.award': 'Award {points} Points Total',

		// --- Kid Timer ---
		'timer.how_long': 'How long do we focus?',
		'timer.min': 'MIN',
		'timer.focus_time': 'FOCUS TIME',
		'timer.paused': 'PAUSED',
		'timer.resume': 'RESUME',
		'timer.pause': 'PAUSE',

		// --- Egg Road ---
		'egg_road.class_energy': 'Class Energy',
		'egg_road.next_goal': 'Next Goal: {points} Points',
		'egg_road.max': 'Max!',
		'egg_road.close': 'Close',
		'egg_road.top_of_class': 'Top of Class',

		// --- Teacher Portal ---
		'teacher_portal.my_classes': 'My Classes',
		'teacher_portal.edit_profile': 'Edit Profile',
		'teacher_portal.logout': 'Logout',
		'teacher_portal.add_new_class': 'Add New Class',
		'teacher_portal.create_new_class': 'Create New Class',
		'teacher_portal.edit_class': 'Edit Class',
		'teacher_portal.delete_class': 'Delete Class?',
		'teacher_portal.delete_confirm': 'Are you sure you want to delete {name}?',
		'teacher_portal.cannot_undo': 'This cannot be undone.',
		'teacher_portal.delete': 'Delete',
		'teacher_portal.students_count': '{count} Students',
		'teacher_portal.change': 'Change',
		'teacher_portal.class_name': 'Class Name',
		'teacher_portal.name_placeholder': 'e.g. 5th Grade Science',
		'teacher_portal.upload_photo': 'Or upload your own photo',
		'teacher_portal.click_upload': 'Click to upload image',
		'teacher_portal.file_types': 'SVG, PNG, JPG',
		'teacher_portal.create': 'Create',
		'teacher_portal.save': 'Save',
		'teacher_portal.sure_logout': 'Are you sure?',
		'teacher_portal.yes': 'Yes',
		'teacher_portal.no': 'No',
		'teacher_portal.click_open': 'Click to open {name} ({count} students)',
		'teacher_portal.edit': 'Edit class',
		'teacher_portal.delete_class_short': 'Delete class',
		'teacher_portal.add_new_class': 'Add a new class',

		// --- Reports Page ---
		'reports.reports': 'Reports',
		'reports.today': 'Today',
		'reports.this_week': 'This Week',
		'reports.this_month': 'This Month',
		'reports.all_time': 'All Time',
		'reports.behavior_history': 'Behavior History',
		'reports.filter': 'Filter',
		'reports.search_student': 'Search students...',
		'reports.no_results': 'No behavior records found for the selected filter.',
		'reports.total_points': 'Total Points',
		'reports.total_wow': 'Wow Points',
		'reports.total_nono': 'Nono Points',
		'reports.points_earned': 'Points Earned',
		'reports.points_lost': 'Points Lost',
		'reports.behaviors': 'Behaviors',
		'reports.date': 'Date',
		'reports.student': 'Student',
		'reports.export': 'Export Report',
		'reports.export_success': 'Report exported successfully!',
		'reports.export_fail': 'Failed to export report.',
		'reports.parent': 'Parent View',
		'reports.teacher': 'Teacher View',

		// --- Class Dashboard ---
		'dashboard.manage_students': 'Manage Students',
		'dashboard.manage_behaviors': 'Manage Behaviors',
		'dashboard.assignments': 'Assignments',
		'dashboard.reports': 'Reports',
		'dashboard.access_codes': 'Access Codes',
		'dashboard.settings': 'Settings',
		'dashboard.points': 'Points',
		'dashboard.energy': 'Energy',
		'dashboard.road': 'Road',
		'dashboard.whiteboard': 'Whiteboard',
		'dashboard.timer': 'Timer',
		'dashboard.lucky_draw': 'Lucky Draw',
		'dashboard.buzzer': 'Buzzer',
		'dashboard.add_student': 'Add Student',
		'dashboard.no_students': 'No students yet. Add your first student to get started!',
		'dashboard.points_history': 'Points History',
		'dashboard.inbox_grading': 'Grading Inbox',
		'dashboard.attendance_mode': 'Attendance Mode',
		'dashboard.class_timer': 'Class Timer',
		'dashboard.attention_buzzer': 'Attention Buzzer',
	// --- Points History View ---
	'points_history.title': 'Points History',
	'points_history.refresh': 'Refresh',
	'points_history.clear_all': 'Clear All History',
	'points_history.wow_points': 'Wow Points',
	'points_history.nono_points': 'No-No Points',
	'points_history.lucky_draws': 'Lucky Draws',
	'points_history.all_types': 'All Types',
	'points_history.wow_cards': 'Wow Cards',
	'points_history.nono_cards': 'No-No Cards',
	'points_history.lucky_draw_filter': 'Lucky Draws',
	'points_history.all_students': 'All Students',
	'points_history.all_time': 'All Time',
	'points_history.today': 'Today',
	'points_history.this_week': 'This Week',
	'points_history.this_month': 'This Month',
	'points_history.no_history': 'No point history found',
	'points_history.try_filters': 'Try adjusting your filters',
	'points_history.showing_filtered': 'Showing',
	'points_history.showing_of': 'of',
	'points_history.showing_events': 'events',
	'points_history.confirm_clear': 'Are you sure you want to clear all point history? This cannot be undone.',
	'points_history.clear_failed': 'Failed to clear history. Please try again.',
	'points_history.select_students': 'Select Students',
	'dashboard.manage_cards': 'Manage Cards',
		'dashboard.create_card': 'Create Card',
		'dashboard.card_type': 'Card Type',
		'dashboard.wow_card': 'Wow Card',
		'dashboard.nono_card': 'Nono Card',
		'dashboard.card_label': 'Card Label',
		'dashboard.card_points': 'Points',
		'dashboard.card_icon': 'Icon',
		'dashboard.save_card': 'Save Card',
		'dashboard.delete_card': 'Delete Card',
		'dashboard.confirm_delete_card': 'Are you sure you want to delete this card?',
		'dashboard.class_settings': 'Class Settings',
		'dashboard.class_name': 'Class Name',
		'dashboard.save_settings': 'Save Settings',

		// --- Student Card ---
		'student_card.give_points': 'Give Points',
		'student_card.view_progress': 'View Progress',
		'student_card.edit_student': 'Edit Student',
		'student_card.delete_student': 'Delete Student',
		'student_card.change_avatar': 'Change avatar',
		'student_card.student_name': 'Student Name',
		'student_card.save_changes': 'Save Changes',

			// --- Edit Student Modal ---
		'edit_student.title': 'Edit Student',
		'edit_student.change_avatar': 'Change avatar',
		'edit_student.student_name': 'Student Name',
		'edit_student.cancel': 'Cancel',
		'edit_student.save_changes': 'Save Changes',
		'edit_student.delete_confirm': 'Delete Student?',
		'edit_student.delete_sure': 'Are you sure you want to delete',
		'edit_student.delete': 'Delete',

		// --- Edit Profile Modal ---
		'profile.edit_profile': 'Edit Profile',
		'profile.change_avatar': 'Change avatar',
		'profile.upload_photo': 'Upload Photo',
		'profile.change_photo': 'Change Photo',
		'profile.remove': 'Remove',
		'profile.full_name': 'Full Name',
		'profile.current_password': 'Current Password (to change password)',
		'profile.new_password': 'New Password',
		'profile.confirm_new_password': 'Confirm New Password',
		'profile.saving': 'Saving...',
		'profile.save_changes': 'Save Changes',
		'profile.passwords_no_match': 'Passwords do not match.',
		'profile.name_empty': 'Name cannot be empty.',
		'profile.image_too_large': 'Image is too large. Please choose a smaller image (under 1MB).',
		'profile.failed_read': 'Failed to read file.',
		'profile.failed_update': 'Failed to update profile.',

		// --- Dashboard Header ---
		'dashboard.menu': 'Menu',
		'dashboard.sort_students': 'Sort Students',
		'dashboard.sort_by': 'Sort By',
		'dashboard.name_az': 'Name (A-Z)',
		'dashboard.highest_points': 'Highest Points',
		'dashboard.display_size': 'Display Size',
		'dashboard.compact': 'Compact',
		'dashboard.regular': 'Regular',
		'dashboard.spacious': 'Spacious',
		'dashboard.enter_fullscreen': 'Enter Fullscreen',
		'dashboard.exit_fullscreen': 'Exit Fullscreen',
		'dashboard.attendance_tip': 'Attendance: Tap students to toggle. Tap icon to save & exit.',
		'dashboard.whole_class': 'Whole Class',
		'dashboard.pts': 'Pts',
		'dashboard.name': 'Name',

		// --- Settings Page ---
		'settings.title': 'Settings',
		'settings.language': 'Language',
		'settings.theme': 'Theme',
		'settings.light': 'Light',
		'settings.dark': 'Dark',
		'settings.system': 'System',
		'settings.account': 'Account',
		'settings.profile': 'Profile',
		'settings.email': 'Email',
		'settings.change_password': 'Change Password',
		'settings.new_password': 'New Password',
		'settings.confirm_new_password': 'Confirm New Password',
		'settings.update_profile': 'Update Profile',
		'settings.delete_account': 'Delete Account',
		'settings.confirm_delete_account': 'Are you sure you want to delete your account? This action cannot be undone.',
		'settings.notifications': 'Notifications',
		'sounds_enabled': 'Sound Effects',
		'settings.notifications_email': 'Email Notifications',
		'settings.about': 'About',
		'settings.version': 'Version',
		'settings.edit_cards': 'Edit point cards',
		'settings.add_card': 'Add Card',
		'settings.new_card': 'New Card',
		'settings.reset': 'Reset',
		'settings.card_label_placeholder': 'Card label',
		'settings.tooltip_add_card': 'Add a new behavior card',
		'settings.tooltip_reset_cards': 'Reset all behavior cards to default',
		'settings.tooltip_done': 'Done and close settings',
		'settings.tooltip_change_sticker': 'Change/choose avatar sticker',
		'settings.tooltip_edit_label': 'Edit card label',
		'settings.tooltip_decrease_points': 'Decrease points',
		'settings.tooltip_increase_points': 'Increase points',
		'settings.tooltip_save': 'Save changes',
		'settings.tooltip_cancel_edit': 'Cancel editing',
		'settings.tooltip_edit_card': 'Edit card',
		'settings.tooltip_delete_card': 'Delete card',

		// --- Assignments Page ---
		'assignments.title': 'Assignments',
		'assignments.create': 'Create Assignment',
		'assignments.edit': 'Edit Assignment',
		'assignments.delete': 'Delete Assignment',
		'assignments.name': 'Assignment Name',
		'assignments.description': 'Description',
		'assignments.due_date': 'Due Date',
		'assignments.points': 'Total Points',
		'assignments.questions': 'Questions',
		'assignments.add_question': 'Add Question',
		'assignments.save': 'Save Assignment',
		'assignments.publish': 'Publish',
		'assignments.unpublish': 'Unpublish',
		'assignments.published': 'Published',
		'assignments.draft': 'Draft',
		'assignments.no_assignments': 'No assignments yet. Create your first assignment!',
		'assignments.student_progress': 'Student Progress',
		'assignments.submitted': 'Submitted',
		'assignments.not_submitted': 'Not Submitted',
		'assignments.grade': 'Grade',
	'assignments.feedback': 'Feedback',

	// --- Whiteboard ---
		'whiteboard.save': 'Save',
		'whiteboard.clear': 'Clear',
		'whiteboard.color': 'Color',
		'whiteboard.size': 'Size',
		'whiteboard.eraser': 'Eraser',
		'whiteboard.pencil': 'Pencil',
		'whiteboard.text': 'Text',
		'whiteboard.emoji': 'Emoji',
		'whiteboard.image': 'Image',
		'whiteboard.undo': 'Undo',
		'whiteboard.redo': 'Redo',
		'whiteboard.font': 'Font',
		'whiteboard.font_size': 'Font Size',

		// --- Parent Portal ---
		'parent_portal.title': 'Parent Portal',
		'parent_portal.child_progress': 'Child\'s Progress',
		'parent_portal.recent_behaviors': 'Recent Behaviors',
		'parent_portal.total_points': 'Total Points',
		'parent_portal.achievements': 'Achievements',

		// --- Student Portal ---
		'student_portal.title': 'Student Portal',
		'student_portal.my_assignments': 'My Assignments',
		'student_portal.my_points': 'My Points',
		'student_portal.my_behaviors': 'My Behaviors',

		// --- General ---
		'general.loading': 'Loading...',
		'general.error': 'Error',
		'general.success': 'Success',
		'general.cancel': 'Cancel',
		'general.save': 'Save',
		'general.delete': 'Delete',
		'general.edit': 'Edit',
		'general.add': 'Add',
		'general.close': 'Close',
		'general.search': 'Search',
		'general.filter': 'Filter',
		'general.export': 'Export',
		'general.import': 'Import',
		'general.confirm': 'Confirm',
		'general.yes': 'Yes',
		'general.no': 'No',
		'general.ok': 'OK',
		'general.back': 'Back',
		'general.next': 'Next',
		'general.previous': 'Previous',
		'general.done': 'Done',
		'general.retry': 'Retry',
		'general.refresh': 'Refresh',
		'general.required': 'Required',
		'general.optional': 'Optional',
	},
	zh: {
		'nav.help': '帮助',
		'nav.login': '登录',
		'nav.signup': '免费注册',
		'hero.title.line1': '课堂管理',
		'hero.title.gradient': '让教学更有魔力。',
		'hero.subtext': '一站式平台，用于行为追踪、趣味化目标以及即时家长沟通。',
		'help.label': '帮助',
		'search.placeholder': '搜索功能...',
		'guide.badge': '课堂手册',
		'hero.tag': '受现代教师信赖',
		'cta.create_class': '创建我的班级',
		'features.title': '运行课堂所需的一切。',
		'modal.who': '选择角色',
		'role.teacher': '教师',
		'role.teacher.desc': '创建班级、分配行为并跟踪进度。',
		'role.parent': '家长',
		'role.parent.desc': '查看孩子的进步并接收更新。',
		'role.student': '学生',
		'role.student.desc': '输入班级访问码以查看作业。',
		'student.instructions': '输入您的5位班级代码以继续。',
		'student.verifying': '验证中...',
		'student.enter': '进入',
		'auth.create_btn': '创建账户',
		'auth.login_btn': '登录',
		'auth.fullname': '姓名',
		'auth.email': '电子邮件',
		'auth.password': '密码',
		'auth.confirm': '确认密码',
		'auth.already': '已有账户？',
		'auth.newhere': '新用户？',
		'auth.create_account': '创建账户',
		'auth.login': '登录',
		'nav.back': '返回',
		'cta.join_today': '立即加入',
		'cta.ready': '准备好提升你的课堂了吗？',

		// --- Email Verification ---
		'auth.account_created': '账户已创建！',
		'auth.verify_msg': '请检查您的邮箱并点击验证链接以激活账户。',
		'auth.verify_block': '在邮箱验证之前，您无法登录。',
		'auth.goto_login': '前往登录',
		'auth.google_signin': '使用 Google 登录',
		'auth.or': '或',

		// --- Feature Section ---
		'features.title': '助力高效教学的全方位功能',
		'features.meter.title': '班级进度条',
		'features.meter.desc': '共同见证班级成长。通过实时进度显示激励学生，共同庆祝每一个里程碑。',
		'features.egg.title': '进度仪表', // Preserved your key
		'features.egg.desc': '用全班协作进度之旅激励学生。', // Preserved your text
		'features.lucky.title': '幸运抽奖',
		'features.lucky.desc': '随机奖励让每节课都充满惊喜。',
		'features.reports.title': '即时报告',
		'features.reports.desc': '追踪进步并与家长分享精美报告。',
		'features.avatars.title': '自定义头像',
		'features.avatars.desc': '让学生用独特有趣的头像表达自我。',

		// --- New Additions (Natural Chinese) ---
		'features.studio.title': '数字化作业',
		'features.studio.desc': '秒级发布数字化练习题，支持即时反馈与评分。',
		'features.codes.title': '快捷访问码',
		'features.codes.desc': '学生专属安全登录码，告别记不住密码的烦恼。',
		'features.timer.title': '专注计时器',
		'features.timer.desc': '内置课堂计时工具，帮学生更好地掌控学习节奏。',
		'features.buzzer.title': '注意力铃声',
		'features.buzzer.desc': '用趣味铃声快速吸引全班注意，让课堂管理更轻松。',
		'features.whiteboard.title': '互动白板',
		'features.whiteboard.desc': '自由书写与绘图，适合小组讨论与创意展示。',
		'features.grading.title': '评价与反馈',
		'features.grading.desc': '即时批改作业并发送评语，让沟通更高效。',
		'features.mgmt.title': '班级管理',
		'features.mgmt.desc': '快速编辑学生名单与头像，所有更改实时保存。',
		'features.settings.title': '自定义设置',
		'features.settings.desc': '随心配置积分规则与评价卡片，适配您的教学风格。',

		// --- 访问码页面 ---
		'access_codes.title': '访问码',
		'access_codes.search': '搜索学生...',
		'access_codes.parent_code': '家长访问码',
		'access_codes.student_code': '学生访问码',
		'access_codes.copy_qr': '复制二维码',
		'access_codes.copied': '已复制！',
		'access_codes.copy_fail': '复制失败。您的浏览器可能不支持此功能。',
		'access_codes.qr_fail': '生成二维码失败。',

		// --- 行为模态框 ---
		'behavior_modal.give_points': '给分',
		'behavior_modal.wow_cards': '奖励卡片',
		'behavior_modal.nono_cards': '扣分卡片',
		'behavior_modal.import': '导入',
		'behavior_modal.select_class': '选择要导入的班级',
		'behavior_modal.choose_class': '-- 请选择班级 --',
		'behavior_modal.preview_new': '预览 — 将导入 {count} 张新卡片',
		'behavior_modal.no_new': '所选班级没有可导入的新卡片',
		'behavior_modal.importing': '导入中…',
		'behavior_modal.import_new': '导入新卡片',
		'behavior_modal.nothing_import': '无需导入',
		'behavior_modal.imported': '已导入 {count} 张新卡片。',
		'behavior_modal.all_set': '已完成 — 没有新卡片可导入。',
		'behavior_modal.import_failed': '导入失败：{message}',
		'behavior_modal.wow': '奖励',
		'behavior_modal.no_no': '扣分',

		// --- 添加学生模态框 ---
		'add_student.title': '添加新学生',
		'add_student.change_avatar': '更换头像',
		'add_student.upload_photo': '上传照片',
		'add_student.change_photo': '更换照片',
		'add_student.remove': '移除',
		'add_student.gender': '性别',
		'add_student.boy': '男生',
		'add_student.girl': '女生',
		'add_student.name_placeholder': '学生姓名',
		'add_student.name_required': '请输入学生姓名。',
		'add_student.cancel': '取消 (Esc)',
		'add_student.add': '添加学生 (Enter)',
		'add_student.image_large': '图片太大。请选择更小的图片（1MB以下）。',

		// --- 幸运抽奖 ---
		'lucky_draw.title': '抽奖',
		'lucky_draw.select_students': '选择学生人数（共 {count} 人）',
		'lucky_draw.not_enough': '学生人数不足',
		'lucky_draw.add_at_least': '至少需要2名学生才能开始抽奖（当前 {count} 人）。',
		'lucky_draw.too_many': '您选择了 {count} 名获奖者，但只有 {total} 名学生。',
		'lucky_draw.chose_smaller': '选择较小的数字',
		'lucky_draw.add_students': '添加学生',
		'lucky_draw.cancel': '取消',
		'lucky_draw.selecting': '选择中...',
		'lucky_draw.selections': '中奖结果！',
		'lucky_draw.selected': '已选中',
		'lucky_draw.award': '奖励 {points} 分',

		// --- 专注计时器 ---
		'timer.how_long': '专注多长时间？',
		'timer.min': '分钟',
		'timer.focus_time': '专注时间',
		'timer.paused': '已暂停',
		'timer.resume': '继续',
		'timer.pause': '暂停',

		// --- 进度之路 ---
		'egg_road.class_energy': '班级能量',
		'egg_road.next_goal': '下一目标：{points} 分',
		'egg_road.max': '已满！',
		'egg_road.close': '关闭',
		'egg_road.top_of_class': '班级前列',

		// --- 教师门户 ---
		'teacher_portal.my_classes': '我的班级',
		'teacher_portal.edit_profile': '编辑资料',
		'teacher_portal.logout': '退出登录',
		'teacher_portal.add_new_class': '添加新班级',
		'teacher_portal.create_new_class': '创建新班级',
		'teacher_portal.edit_class': '编辑班级',
		'teacher_portal.delete_class': '删除班级？',
		'teacher_portal.delete_confirm': '确定要删除 {name} 吗？',
		'teacher_portal.cannot_undo': '此操作无法撤销。',
		'teacher_portal.delete': '删除',
		'teacher_portal.students_count': '{count} 名学生',
		'teacher_portal.change': '更换',
		'teacher_portal.class_name': '班级名称',
		'teacher_portal.name_placeholder': '例如：五年级科学班',
		'teacher_portal.upload_photo': '或上传您的照片',
		'teacher_portal.click_upload': '点击上传图片',
		'teacher_portal.file_types': 'SVG、PNG、JPG',
		'teacher_portal.create': '创建',
		'teacher_portal.save': '保存',
		'teacher_portal.sure_logout': '确定要退出吗？',
		'teacher_portal.yes': '是',
		'teacher_portal.no': '否',
		'teacher_portal.click_open': '点击打开 {name}（{count} 名学生）',
		'teacher_portal.edit': '编辑班级',
		'teacher_portal.delete_class_short': '删除班级',
		'teacher_portal.add_new_class': '添加新班级',

		// --- 报告页面 ---
		'reports.reports': '报告',
		'reports.today': '今天',
		'reports.this_week': '本周',
		'reports.this_month': '本月',
		'reports.all_time': '全部时间',
		'reports.behavior_history': '行为历史',
		'reports.filter': '筛选',
		'reports.search_student': '搜索学生...',
		'reports.no_results': '所选筛选条件下未找到行为记录。',
		'reports.total_points': '总积分',
		'reports.total_wow': '奖励积分',
		'reports.total_nono': '扣分积分',
		'reports.points_earned': '获得积分',
		'reports.points_lost': '扣除积分',
		'reports.behaviors': '行为',
		'reports.date': '日期',
		'reports.student': '学生',
		'reports.export': '导出报告',
		'reports.export_success': '报告导出成功！',
		'reports.export_fail': '报告导出失败。',
		'reports.parent': '家长视图',
		'reports.teacher': '教师视图',

		// --- 班级主页 ---
		'dashboard.manage_students': '管理学生',
		'dashboard.manage_behaviors': '管理行为卡片',
		'dashboard.assignments': '作业',
		'dashboard.reports': '报告',
		'dashboard.access_codes': '访问码',
		'dashboard.settings': '设置',
		'dashboard.points': '积分',
		'dashboard.energy': '能量',
		'dashboard.road': '进度',
		'dashboard.whiteboard': '白板',
		'dashboard.timer': '计时器',
		'dashboard.lucky_draw': '抽奖',
		'dashboard.buzzer': '铃声',
		'dashboard.add_student': '添加学生',
		'dashboard.no_students': '还没有学生。添加您的第一个学生开始吧！',
		'dashboard.points_history': '积分历史',
		// --- Points History View ---
	'points_history.title': '积分历史',
	'points_history.refresh': '刷新',
	'points_history.clear_all': '清空历史',
	'points_history.wow_points': '哇哇积分',
	'points_history.nono_points': '扣分',
	'points_history.lucky_draws': '抽奖奖励',
	'points_history.all_types': '全部类型',
	'points_history.wow_cards': '哇哇卡',
	'points_history.nono_cards': '禁止卡',
	'points_history.lucky_draw_filter': '抽奖',
	'points_history.all_students': '全部学生',
	'points_history.select_students': '选择学生',
	'points_history.all_time': '全部时间',
	'points_history.today': '今天',
	'points_history.this_week': '本周',
	'points_history.this_month': '本月',
	'points_history.no_history': '暂无积分历史',
	'points_history.try_filters': '尝试调整筛选条件',
	'points_history.showing_filtered': '显示',
	'points_history.showing_of': '/',
	'points_history.showing_events': '条记录',
	'points_history.confirm_clear': '确定要清空所有积分历史吗？此操作无法撤销。',
	'points_history.clear_failed': '清空历史失败，请重试。',
	'dashboard.inbox_grading': '收件箱与评分',
		'dashboard.attendance_mode': '出勤模式',
		'dashboard.class_timer': '班级计时器',
		'dashboard.attention_buzzer': '注意力铃声',
		'dashboard.manage_cards': '管理卡片',
		'dashboard.create_card': '创建卡片',
		'dashboard.card_type': '卡片类型',
		'dashboard.wow_card': '奖励卡片',
		'dashboard.nono_card': '扣分卡片',
		'dashboard.card_label': '卡片名称',
		'dashboard.card_points': '积分',
		'dashboard.card_icon': '图标',
		'dashboard.save_card': '保存卡片',
		'dashboard.delete_card': '删除卡片',
		'dashboard.confirm_delete_card': '确定要删除这张卡片吗？',
		'dashboard.class_settings': '班级设置',
		'dashboard.class_name': '班级名称',
		'dashboard.save_settings': '保存设置',

		// --- 学生卡片 ---
		'student_card.give_points': '给分',
		'student_card.view_progress': '查看进度',
		'student_card.edit_student': '编辑学生',
		'student_card.delete_student': '删除学生',
		'student_card.change_avatar': '更换头像',
		'student_card.student_name': '学生姓名',
		'student_card.save_changes': '保存更改',

		// --- 编辑学生模态框 ---
		'edit_student.title': '编辑学生',
		'edit_student.change_avatar': '更换头像',
		'edit_student.student_name': '学生姓名',
		'edit_student.cancel': '取消',
		'edit_student.save_changes': '保存更改',
		'edit_student.delete_confirm': '删除学生？',
		'edit_student.delete_sure': '确定要删除',
		'edit_student.delete': '删除',

	// --- 编辑资料模态框 ---
		'profile.edit_profile': '编辑资料',
		'profile.change_avatar': '更换头像',
		'profile.upload_photo': '上传照片',
		'profile.change_photo': '更换照片',
		'profile.remove': '移除',
		'profile.full_name': '姓名',
		'profile.current_password': '当前密码（用于修改密码）',
		'profile.new_password': '新密码',
		'profile.confirm_new_password': '确认新密码',
		'profile.saving': '保存中...',
		'profile.save_changes': '保存更改',
		'profile.passwords_no_match': '两次输入的密码不匹配。',
		'profile.name_empty': '姓名不能为空。',
		'profile.image_too_large': '图片太大。请选择更小的图片（1MB以下）。',
		'profile.failed_read': '读取文件失败。',
		'profile.failed_update': '更新资料失败。',

	// --- 班级主页头部 ---
		'dashboard.menu': '菜单',
		'dashboard.sort_students': '排序学生',
		'dashboard.sort_by': '排序方式',
		'dashboard.name_az': '姓名（A-Z）',
		'dashboard.highest_points': '最高积分',
		'dashboard.display_size': '显示大小',
		'dashboard.compact': '紧凑',
		'dashboard.regular': '常规',
		'dashboard.spacious': '宽敞',
		'dashboard.enter_fullscreen': '进入全屏',
		'dashboard.exit_fullscreen': '退出全屏',
		'dashboard.attendance_tip': '出勤：点击学生切换状态。点击图标保存并退出。',
		'dashboard.whole_class': '全班',
		'dashboard.pts': '分',
		'dashboard.name': '姓名',

	// --- 设置页面 ---
		'settings.title': '设置',
		'settings.language': '语言',
		'settings.theme': '主题',
		'settings.light': '浅色',
		'settings.dark': '深色',
		'settings.system': '跟随系统',
		'settings.account': '账户',
		'settings.profile': '个人资料',
		'settings.email': '邮箱',
		'settings.change_password': '修改密码',
		'settings.new_password': '新密码',
		'settings.confirm_new_password': '确认新密码',
		'settings.update_profile': '更新资料',
		'settings.delete_account': '删除账户',
		'settings.confirm_delete_account': '确定要删除您的账户吗？此操作无法撤销。',
		'settings.notifications': '通知',
		'sounds_enabled': '音效',
		'settings.notifications_email': '邮件通知',
		'settings.about': '关于',
		'settings.version': '版本',
		'settings.edit_cards': '编辑积分卡片',
		'settings.add_card': '添加卡片',
		'settings.new_card': '新卡片',
		'settings.reset': '重置',
		'settings.card_label_placeholder': '卡片名称',
		'settings.tooltip_add_card': '添加新的行为卡片',
		'settings.tooltip_reset_cards': '重置所有行为卡片为默认',
		'settings.tooltip_done': '完成并关闭设置',
		'settings.tooltip_change_sticker': '更改/选择头像贴纸',
		'settings.tooltip_edit_label': '编辑卡片名称',
		'settings.tooltip_decrease_points': '减少积分',
		'settings.tooltip_increase_points': '增加积分',
		'settings.tooltip_save': '保存更改',
		'settings.tooltip_cancel_edit': '取消编辑',
		'settings.tooltip_edit_card': '编辑卡片',
		'settings.tooltip_delete_card': '删除卡片',

		// --- 作业页面 ---
		'assignments.title': '作业',
		'assignments.create': '创建作业',
		'assignments.edit': '编辑作业',
		'assignments.delete': '删除作业',
		'assignments.name': '作业名称',
		'assignments.description': '描述',
		'assignments.due_date': '截止日期',
		'assignments.points': '总分',
		'assignments.questions': '问题',
		'assignments.add_question': '添加问题',
		'assignments.save': '保存作业',
		'assignments.publish': '发布',
		'assignments.unpublish': '取消发布',
		'assignments.published': '已发布',
		'assignments.draft': '草稿',
		'assignments.no_assignments': '还没有作业。创建您的第一个作业吧！',
		'assignments.student_progress': '学生进度',
		'assignments.submitted': '已提交',
		'assignments.not_submitted': '未提交',
		'assignments.grade': '评分',
		'assignments.feedback': '反馈',

		// --- 白板 ---
		'whiteboard.save': '保存',
		'whiteboard.clear': '清除',
		'whiteboard.color': '颜色',
		'whiteboard.size': '大小',
		'whiteboard.eraser': '橡皮擦',
		'whiteboard.pencil': '画笔',
		'whiteboard.text': '文字',
		'whiteboard.emoji': '表情',
		'whiteboard.image': '图片',
		'whiteboard.undo': '撤销',
		'whiteboard.redo': '重做',
		'whiteboard.font': '字体',
		'whiteboard.font_size': '字号',

		// --- 家长门户 ---
		'parent_portal.title': '家长门户',
		'parent_portal.child_progress': '孩子进度',
		'parent_portal.recent_behaviors': '近期行为',
		'parent_portal.total_points': '总积分',
		'parent_portal.achievements': '成就',

		// --- 学生门户 ---
		'student_portal.title': '学生门户',
		'student_portal.my_assignments': '我的作业',
		'student_portal.my_points': '我的积分',
		'student_portal.my_behaviors': '我的行为',

		// --- 通用 ---
		'general.loading': '加载中...',
		'general.error': '错误',
		'general.success': '成功',
		'general.cancel': '取消',
		'general.save': '保存',
		'general.delete': '删除',
		'general.edit': '编辑',
		'general.add': '添加',
		'general.close': '关闭',
		'general.search': '搜索',
		'general.filter': '筛选',
		'general.export': '导出',
		'general.import': '导入',
		'general.confirm': '确认',
		'general.yes': '是',
		'general.no': '否',
		'general.ok': '确定',
		'general.back': '返回',
		'general.next': '下一步',
		'general.previous': '上一步',
		'general.done': '完成',
		'general.retry': '重试',
		'general.refresh': '刷新',
		'general.required': '必填',
		'general.optional': '选填',
	}
};

export function LanguageProvider(props) {
	const children = props.children;
	const [lang, setLang] = useState(() => {
		try { return localStorage.getItem('classABC_lang') || 'en'; } catch { return 'en'; }
	});

	useEffect(() => {
		try { localStorage.setItem('classABC_lang', lang); } catch {
			// Intentionally ignore localStorage errors
		}
	}, [lang]);

	return React.createElement(
		LanguageContext.Provider,
		{ value: { lang: lang, setLang: setLang } },
		children
	);
}

export function useTranslation() {
	const ctx = useContext(LanguageContext) || { lang: 'en', setLang: () => { } };
	const t = (key) => {
		const dict = TRANSLATIONS[ctx.lang] || TRANSLATIONS.en;
		return dict[key] || TRANSLATIONS.en[key] || key;
	};
	return { t, lang: ctx.lang, setLang: ctx.setLang };
}

export default LanguageContext;

